(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{118:function(e,t,n){e.exports=n(298)},123:function(e,t,n){},125:function(e,t,n){},141:function(e,t){},145:function(e,t){},161:function(e,t){},187:function(e,t){},189:function(e,t){},211:function(e,t){},278:function(e,t){},298:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(113),u=n.n(c),l=(n(123),n(5)),i=n.n(l),o=n(24),s=n(114),d=n(115),m=n(23),g=n(117),h=n(116),_=(n(125),n(16)),f=n(65),w=n.n(f),p=(_.keyStores,_.KeyPair,_.connect,_.utils),b=w()(10).pow(12),E=(w()(200).mul(b),function(e){Object(g.a)(n,e);var t=Object(h.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state={connected:!1,signedIn:!1,accountId:null,balance:null,contract_accountId:"support123.testnet",contract_sign_accountId:"owner123.testnet",new_crowdfunding_theme:"",new_crowdfunding_receiver:"",new_crowdfunding_funding_goal:0,crowdFunding_campagins:new Array,crowdFunding_funding_map:new Map,crowdFunding_fundings:new Array,crowdfunding_num:0,crowdfunding_goal:0},a.handleNewCrowdChange=a.handleNewCrowdChange.bind(Object(m.a)(a)),a.handleNewReceiverChange=a.handleNewReceiverChange.bind(Object(m.a)(a)),a.handleNewFundingGoalChange=a.handleNewFundingGoalChange.bind(Object(m.a)(a)),a.createNewCrowdSubmit=a.createNewCrowdSubmit.bind(Object(m.a)(a)),a.sendCrowdFundGoalSubmit=a.sendCrowdFundGoalSubmit.bind(Object(m.a)(a)),a._initNear().then((function(){a.setState({connected:!0,signedIn:!!a._accountId,accountId:a._accountId,balance:a._balance})})),a}return Object(d.a)(n,[{key:"handleNewCrowdChange",value:function(e){console.log("\u52df\u6350\u6d3b\u52a8\u540d\u79f0\uff1a"+e.target.value),this.setState({new_crowdfunding_theme:e.target.value})}},{key:"handleNewReceiverChange",value:function(e){console.log("\u52df\u6350\u6d3b\u52a8\u63a5\u6536\u8d26\u6237\uff1a"+e.target.value),this.setState({new_crowdfunding_receiver:e.target.value})}},{key:"handleNewFundingGoalChange",value:function(e){console.log("\u52df\u6350\u6d3b\u52a8\u7b79\u96c6\u76ee\u6807\u91d1\u989d\uff1a"+e.target.value),this.setState({new_crowdfunding_funding_goal:e.target.value})}},{key:"handlewCrowdFundingNumChange",value:function(e){console.log("\u53c2\u4e0e\u52df\u6350\u6d3b\u52a8\u7684\u7f16\u53f7\uff1a"+e.target.value),this.setState({crowdfunding_num:e.target.value})}},{key:"handlewCrowdFundingGoalChange",value:function(e){console.log("\u53c2\u4e0e\u52df\u6350\u7684\u91d1\u989d\uff1a"+e.target.value),this.setState({crowdfunding_goal:e.target.value})}},{key:"createNewCrowdSubmit",value:function(e){this.createNewCrowd(),e.preventDefault()}},{key:"createNewCrowd",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._contract.newCampaign({theme:this.state.new_crowdfunding_theme,receiver:this.state.new_crowdfunding_receiver,number_funders:0,funding_goal:Number(this.state.new_crowdfunding_funding_goal)});case 2:if(!((t=e.sent)>0)){e.next=8;break}if(alert("\u5408\u7ea6\u521b\u5efa\u6210\u529f\uff0c\u5408\u7ea6\u7f16\u53f7\uff1a"+t),!this._accountId){e.next=8;break}return e.next=8,this.refreshAccountStats();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendCrowdFundGoalSubmit",value:function(e){this.bidCrowdFund(),e.preventDefault()}},{key:"bidCrowdFund",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._account.functionCall({contractId:this.state.contract_accountId,methodName:"bid",args:{num_campagins:Number(this.state.crowdfunding_num)},gas:"300000000000000",attachedDeposit:p.format.parseNearAmount(this.state.crowdfunding_goal)});case 2:if(!((t=e.sent)>0)){e.next=8;break}if(console.log("\u7b2c\uff1a"+t+"\u4f4d\u6350\u8d60\u4eba"),!this._accountId){e.next=8;break}return e.next=8,this.refreshAccountStats();case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"withdrawToReceiver",value:function(){var e=Object(o.a)(i.a.mark((function e(t){var n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.confirm("\u60a8\u786e\u5b9a\u8f6c\u8d26\u5417?")){e.next=8;break}return e.next=3,this._contract.withdraw_to_receiver({num_campagins:t});case 3:if(n=e.sent,this.setState({balance:n}),!this._accountId){e.next=8;break}return e.next=8,this.refreshAccountStats();case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_initNear",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t,n,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={networkId:"default",nodeUrl:"https://rpc.testnet.near.org",contractName:this.state.contract_accountId,walletUrl:"https://wallet.testnet.near.org"},n=new _.keyStores.BrowserLocalStorageKeyStore,e.next=4,_.connect(Object.assign({deps:{keyStore:n}},t));case 4:return a=e.sent,this._keyStore=n,this._nearConfig=t,this._near=a,this._walletConnection=new _.WalletConnection(a,this.state.contract_accountId),this._accountId=this._walletConnection.getAccountId(),this._account=this._walletConnection.account(),e.next=13,this._account.getAccountBalance();case 13:if(this._balance=e.sent.total,console.log("_accountId="+this._accountId+", _account="+this._account),this._contract=new _.Contract(this._account,this.state.contract_accountId,{viewMethods:["get_crowdFunding_by_num_campagins","get_all_crowdFunding","get_funders_by_num_campagins"],changeMethods:["newCampaign","bid","withdraw_to_receiver"]}),!this._accountId){e.next=19;break}return e.next=19,this.refreshAccountStats();case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshAccountStats",value:function(){var e=Object(o.a)(i.a.mark((function e(){var t,n,a,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._contract.get_all_crowdFunding();case 2:t=e.sent,n=0;case 4:if(!(n<t.length)){e.next=15;break}return(a=t[n]).num_campagins=n+1,this.state.crowdFunding_campagins.push(a),e.next=10,this._contract.get_funders_by_num_campagins({num_campagins:a.num_campagins});case 10:(r=e.sent).length>0&&this.state.crowdFunding_funding_map.set(a.num_campagins,r);case 12:n++,e.next=4;break;case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestSignIn",value:function(){var e=Object(o.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"\u53bb\u4e2d\u5fc3\u5316\u52df\u6350\u5e73\u53f0",e.next=3,this._walletConnection.requestSignIn(this.state.contract_accountId,"\u53bb\u4e2d\u5fc3\u5316\u52df\u6350\u5e73\u53f0");case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logOut",value:function(){var e=Object(o.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._walletConnection.signOut(),this._accountId=null,this.setState({signedIn:!!this._accountId,accountId:this._accountId,balance:this._balance});case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;console.log("call render().");var t=1e24,n=this.state.connected?this.state.signedIn?r.a.createElement("div",null,r.a.createElement("div",{className:"float-right"},r.a.createElement("button",{className:"btn btn-outline-secondary",onClick:function(){return e.logOut()}},"\u9000\u51fa")),r.a.createElement("h5",null,r.a.createElement("span",{className:"font-weight-bold"},"\u5f53\u524d\u767b\u9646NEAR\u8d26\u53f7\uff1a",this.state.accountId,", \u8d26\u53f7\u4f59\u989d\uff1a",this.state.balance," yoctoNEAR (\u2248",this.state.balance/t," NEAR)")),r.a.createElement("div",null),this.state.contract_sign_accountId===this.state.accountId?r.a.createElement("div",null,r.a.createElement("h6",null,r.a.createElement("span",{className:"font-weight-bold"},"\u60a8\u6709\u6743\u521b\u5efa\u52df\u6350\u6d3b\u52a8")),r.a.createElement("hr",null),r.a.createElement("label",{style:{marginTop:"10px"}}," \u3013 \u521b\u5efa\u52df\u6350\u6d3b\u52a8\u3013 "),r.a.createElement("form",{onSubmit:this.createNewCrowdSubmit},r.a.createElement("label",null,"\u6d3b\u52a8\u540d\u79f0\uff1a ",r.a.createElement("input",{type:"text",style:{marginLeft:"10px"},value:this.state.new_crowdfunding_theme,onChange:function(t){e.handleNewCrowdChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("label",null,"\u63a5\u6536\u52df\u6350\u8d26\u6237\uff1a",r.a.createElement("input",{type:"text",style:{marginLeft:"10px"},value:this.state.new_crowdfunding_receiver,onChange:function(t){e.handleNewReceiverChange(t)}})," "),r.a.createElement("br",null),r.a.createElement("label",null,"\u52df\u6350\u76ee\u6807\u91d1\u989d\uff1a ",r.a.createElement("input",{type:"number",style:{marginLeft:"10px"},value:this.state.new_crowdfunding_funding_goal,onChange:function(t){e.handleNewFundingGoalChange(t)}})," NEAR "),r.a.createElement("br",null),r.a.createElement("input",{type:"submit",value:"\u63d0\u4ea4"})),r.a.createElement("hr",null),r.a.createElement("div",{style:{fontSize:"16px"}},r.a.createElement("label",null," \u3013 \u5df2\u521b\u5efa\u7684\u52df\u6350\u6d3b\u52a8\u5217\u8868 \u3013 ")," ",r.a.createElement("br",null),this.state.crowdFunding_campagins.map((function(n){return r.a.createElement("li",{key:n},"\u300e\u7f16\u53f7\u300f\uff1a",n.num_campagins,",\u300e\u6d3b\u52a8\u540d\u79f0\u300f\uff1a",n.theme,",\u300e\u52df\u6350\u63a5\u6536\u8d26\u6237\u300f\uff1a",n.receiver,",\u300e\u52df\u8d44\u76ee\u6807\u91d1\u989d\u300f\uff1a",n.funding_goal,"yoctoNEAR (\u2248",n.funding_goal/t," NEAR),\u300e\u52df\u8d44\u53c2\u4e0e\u4eba\u6570\u300f\uff1a",n.number_funders,",\u300e\u5df2\u7ecf\u52df\u96c6\u7684\u91d1\u989d\u300f\uff1a",n.total_amount,"yoctoNEAR (\u2248",n.total_amount/t," NEAR)",r.a.createElement("br",null),r.a.createElement("label",{style:{fontSize:"13px"}},"  \u273f \u52df\u6350\u4eba\u5217\u8868 ")," ",r.a.createElement("br",null),r.a.createElement("div",{style:{fontSize:"10px"}},null!=e.state.crowdFunding_funding_map.get(n.num_campagins)&&void 0!=e.state.crowdFunding_funding_map.get(n.num_campagins)&&e.state.crowdFunding_funding_map.get(n.num_campagins).length>0?e.state.crowdFunding_funding_map.get(n.num_campagins).map((function(e){return r.a.createElement("div",{key:e}," \u25e6  \u6350\u8d60\u4eba\u5730\u5740\uff1a",e.addr+", "," \u6350\u8d60\u91d1\u989d\uff1a",e.amount," yoctoNEAR (\u2248",e.amount/t," NEAR)",r.a.createElement("br",null))})):r.a.createElement("label",null," \u65e0\u6350\u8d60\u4eba.")))}))),r.a.createElement("br",null),r.a.createElement("hr",null)):this.state.contract_accountId===this.state.accountId?r.a.createElement("div",null,r.a.createElement("h6",null,r.a.createElement("span",{className:"font-weight-bold"},"\u8f6c\u8d26\u5230\u52df\u6350\u6d3b\u52a8\u63a5\u6536\u8d26\u6237")),this.state.crowdFunding_campagins.map((function(n){return r.a.createElement("div",null,r.a.createElement("label",null,"\u300e\u7f16\u53f7\u300f: ",n.num_campagins,",\u300e\u6d3b\u52a8\u540d\u79f0\u300f: ",n.theme,",\u300e\u52df\u6350\u63a5\u6536\u8d26\u6237\u300f: ",n.receiver,",\u300e\u52df\u8d44\u76ee\u6807\u91d1\u989d\u300f\uff1a",n.funding_goal,"yoctoNEAR (\u2248",n.funding_goal/t," NEAR),\u300e\u5df2\u52df\u6350\u91d1\u989d\u300f: ",n.total_amount," yoctoNEAR (\u2248",n.total_amount/t," NEAR),\u300e\u52df\u6350\u6d3b\u52a8\u63a5\u6536\u8d26\u6237\u6536\u5230\u7684\u91d1\u989d\u300f: ",n.withdraw_amount," yoctoNEAR (\u2248",n.withdraw_amount/t," NEAR)",n.total_amount>n.withdraw_amount?r.a.createElement("label",null,"\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0",r.a.createElement("button",{className:"btn btn-primary",onClick:function(){return e.withdrawToReceiver(n.num_campagins)}},"\u8f6c\u8d26\u5230\u52df\u6350\u6d3b\u52a8\u63a5\u6536\u8d26\u6237")):r.a.createElement("p",null,"\xa0\xa0")),r.a.createElement("br",null),r.a.createElement("hr",null))}))):r.a.createElement("div",null,r.a.createElement("h6",null,r.a.createElement("span",{className:"font-weight-bold"},"\u6b22\u8fce\u60a8\u53c2\u4e0e\u52df\u6350\u6d3b\u52a8")),r.a.createElement("hr",null),r.a.createElement("label",null," \u8bf7\u9009\u62e9\u60a8\u8981\u53c2\u4e0e\u7684\u52df\u6350\u6d3b\u52a8 ")," ",r.a.createElement("br",null),this.state.crowdFunding_campagins.map((function(e){return r.a.createElement("div",null,r.a.createElement("label",null,"\u300e\u7f16\u53f7\u300f: ",e.num_campagins,",\u300e\u6d3b\u52a8\u540d\u79f0\u300f: ",e.theme,",\u300e\u52df\u6350\u63a5\u6536\u8d26\u6237\u300f: ",e.receiver,",\u300e\u52df\u8d44\u76ee\u6807\u91d1\u989d\u300f\uff1a",e.funding_goal,"yoctoNEAR (\u2248",e.funding_goal/t," NEAR),\u300e\u52df\u6350\u4eba\u6570\u300f: ",e.number_funders," "),r.a.createElement("br",null))})),r.a.createElement("hr",null),r.a.createElement("form",{onSubmit:this.sendCrowdFundGoalSubmit},r.a.createElement("label",null,"\u6d3b\u52a8\u7f16\u53f7\uff1a ",r.a.createElement("input",{type:"text",style:{marginLeft:"10px"},value:this.state.crowdfunding_num,onChange:function(t){e.handlewCrowdFundingNumChange(t)}})," (-\u8bf7\u9009\u62e9\u4e0a\u9762\u7684\u6d3b\u52a8\u7f16\u53f7-)"),r.a.createElement("br",null),r.a.createElement("label",null,"\u52df\u6350\u91d1\u989d\uff1a ",r.a.createElement("input",{type:"number",style:{marginLeft:"10px"},value:this.state.crowdfunding_goal,onChange:function(t){e.handlewCrowdFundingGoalChange(t)}})," NEAR"),r.a.createElement("br",null),r.a.createElement("input",{type:"submit",value:"\u63d0\u4ea4"})))):r.a.createElement("div",{style:{marginBottom:"10px"}},r.a.createElement("button",{className:"btn btn-primary",onClick:function(){return e.requestSignIn()}},"\u767b\u9646NEAR\u94b1\u5305")):r.a.createElement("div",null,"\u6b63\u5728\u94fe\u63a5NEAR\u94b1\u5305 ...",r.a.createElement("span",{className:"spinner-grow spinner-grow-sm",role:"status","aria-hidden":"true"}));return r.a.createElement("div",{className:"px-5"},r.a.createElement("h1",null,"NEAR\u53bb\u4e2d\u5fc3\u5316\u52df\u6350\u6d3b\u52a8\u5e73\u53f0"),r.a.createElement("span",{className:"font-weight-light"},"(\u63d0\u793a\u26a0\ufe0f\uff1a\u52df\u6350\u6d3b\u52a8\u5408\u7ea6\u5df2\u7ecf\u90e8\u7f72\u5230\u6d4b\u8bd5\u94fe\uff0c\u5408\u7ea6\u8d26\u6237\uff1a",this.state.contract_accountId,"\uff0c\u6388\u6743\u8d26\u6237\uff1a",this.state.contract_sign_accountId,")"),n)}}]),n}(r.a.Component));u.a.render(r.a.createElement(E,null),document.getElementById("root"))}},[[118,1,2]]]);
//# sourceMappingURL=main.5a0e4a57.chunk.js.map